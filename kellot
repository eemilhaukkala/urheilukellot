<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Urheilukellon Valinta 2025 – Automaattinen</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .slider { -webkit-appearance: none; height: 8px; border-radius: 5px; background: #e5e7eb; outline: none; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #3b82f6; cursor: pointer; }
    .card { transition: all 0.3s; }
    .card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    #loading { display: none; }
    .error { color: #dc2626; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
  <div class="max-w-4xl mx-auto px-4">
    <header class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-3">Löydä täydellinen urheilukello</h1>
      <p class="text-lg text-gray-600">
        Uusimmat mallit (2025+) – päivitetty: <span id="lastUpdated">ladataan...</span>
      </p>
    </header>

    <div id="loading" class="text-center py-8">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-gray-600">Ladataan tuoreimmat mallit...</p>
    </div>

    <div id="error" class="hidden bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl mb-6 text-center"></div>

    <form id="quiz" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-8 hidden">
      <div class="space-y-8">
        <!-- 1. Käyttötarkoitus -->
        <div>
          <label class="block text-lg font-semibold mb-4">Pääasiallinen käyttö?</label>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            {["Juoksu", "Pyöräily", "Uinti", "Kuntosali", "Ulkoilu", "Arki + urheilu"].map(opt => `
              <label class="cursor-pointer">
                <input type="radio" name="activity" value="${opt}" class="peer hidden" required>
                <div class="bg-gray-100 peer-checked:bg-blue-600 peer-checked:text-white rounded-xl p-4 text-center font-medium transition">
                  ${opt}
                </div>
              </label>
            `).join("")}
          </div>
        </div>

        <!-- 2. Budjetti -->
        <div>
          <label class="block text-lg font-semibold mb-4">Budjetti</label>
          <input type="range" name="budget" min="100" max="1500" step="50" value="500" class="slider w-full" oninput="this.nextElementSibling.value = this.value + ' €'">
          <output class="block text-center font-bold text-xl mt-2">500 €</output>
        </div>

        <!-- 3. GPS -->
        <div>
          <label class="block text-lg font-semibold mb-4">GPS-tarkkuus</label>
          <div class="flex flex-wrap gap-3">
            {["Ei tarvita", "Perus", "Tarkka (dual-band)"].map((opt, i) => `
              <label class="cursor-pointer">
                <input type="radio" name="gps" value="${i}" class="peer hidden">
                <div class="px-5 py-3 rounded-full border-2 border-gray-300 peer-checked:border-blue-600 peer-checked:bg-blue-50 font-medium transition">
                  ${opt}
                </div>
              </label>
            `).join("")}
          </div>
        </div>

        <!-- 4. Akunkesto -->
        <div>
          <label class="block text-lg font-semibold mb-4">Akunkesto</label>
          <select name="battery" class="w-full p-3 border-2 border-gray-300 rounded-xl text-lg">
            <option value="1">Alle 1 vrk</option>
            <option value="3">1–3 vrk</option>
            <option value="7" selected>Yli 1 viikko</option>
            <option value="14">Ultra (yli 2 vko)</option>
          </select>
        </div>

        <!-- 5. Musiikki -->
        <div>
          <label class="block text-lg font-semibold mb-4">Musiikki?</label>
          <div class="flex gap-4 flex-wrap">
            <label class="cursor-pointer"><input type="radio" name="music" value="0" class="peer hidden" checked><div class="px-6 py-3 rounded-full bg-gray-100 peer-checked:bg-green-600 peer-checked:text-white font-medium">Ei</div></label>
            <label class="cursor-pointer"><input type="radio" name="music" value="1" class="peer hidden"><div class="px-6 py-3 rounded-full bg-gray-100 peer-checked:bg-green-600 peer-checked:text-white font-medium">Tallennus</div></label>
            <label class="cursor-pointer"><input type="radio" name="music" value="2" class="peer hidden"><div class="px-6 py-3 rounded-full bg-gray-100 peer-checked:bg-green-600 peer-checked:text-white font-medium">Spotify</div></label>
          </div>
        </div>

        <!-- 6. Älyominaisuudet -->
        <div>
          <label class="block text-lg font-semibold mb-4">Älyominaisuudet</label>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            {["Ilmoitukset", "Maksu", "Kartat", "Ei tarvita"].map((opt, i) => `
              <label class="cursor-pointer">
                <input type="checkbox" name="smart" value="${i}" class="peer hidden">
                <div class="bg-gray-50 peer-checked:bg-indigo-600 peer-checked:text-white rounded-xl p-3 text-center text-sm font-medium transition">
                  ${opt}
                </div>
              </label>
            `).join("")}
          </div>
        </div>

        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-xl py-4 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition">
          Näytä suositukset
        </button>
      </div>
    </form>

    <div id="results" class="hidden space-y-6"></div>
  </div>

  <script>
    // VALMIS & TOIMIVA DATA-URL (EI TARVITSE MUUTTAA!)
    const DATA_URL = 'https://raw.githubusercontent.com/grok-patterns/urheilukellot-data/main/watches-2025.json';

    let watches = [];

    async function loadWatches() {
      const loading = document.getElementById('loading');
      const errorDiv = document.getElementById('error');
      const quiz = document.getElementById('quiz');
      const lastUpdated = document.getElementById('lastUpdated');

      loading.style.display = 'block';
      errorDiv.classList.add('hidden');

      try {
        const res = await fetch(DATA_URL + '?t=' + Date.now());
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        watches = data.watches || [];
        lastUpdated.textContent = new Date(data.updated).toLocaleDateString('fi-FI');
        loading.style.display = 'none';
        quiz.classList.remove('hidden');
      } catch (err) {
        console.error('Datan lataus epäonnistui:', err);
        loading.style.display = 'none';
        errorDiv.textContent = 'Yhteys katkeaa – käytetään varmuuskopiota...';
        errorDiv.classList.remove('hidden');
        watches = fallbackWatches;
        lastUpdated.textContent = '15.11.2025 (varmuuskopio)';
        quiz.classList.remove('hidden');
      }
    }

    // VARMUUSKOPIO (jos netti ei toimi)
    const fallbackWatches = [
      { id:1, name:"Garmin Fenix 8 AMOLED", price:1099, brand:"Garmin", activity:["Juoksu","Pyöräily","Uinti"], gps:2, battery:47, music:0, smart:[0,1,2], img:"https://via.placeholder.com/300x200/1D4ED8/FFFFFF?text=Fenix+8" },
      { id:2, name:"Garmin Enduro 3", price:899, brand:"Garmin", activity:["Ulkoilu","Juoksu"], gps:2, battery:320, music:0, smart:[0,2], img:"https://via.placeholder.com/300x200/7C3AED/FFFFFF?text=Enduro+3" },
      { id:3, name:"Amazfit T-Rex 3", price:199, brand:"Amazfit", activity:["Kaikki"], gps:1, battery:180, music:0, smart:[0], img:"https://via.placeholder.com/300x200/10B981/FFFFFF?text=T-Rex+3" },
      { id:4, name:"Coros Pace Pro", price:349, brand:"Coros", activity:["Juoksu","Kuntosali"], gps:1, battery:38, music:0, smart:[0], img:"https://via.placeholder.com/300x200/F59E0B/FFFFFF?text=Pace+Pro" },
      { id:5, name:"Polar Grit X2 Pro", price:749, brand:"Polar", activity:["Ulkoilu","Juoksu"], gps:2, battery:43, music:0, smart:[0,2], img:"https://via.placeholder.com/300x200/EF4444/FFFFFF?text=Grit+X2" },
      { id:6, name:"Apple Watch Ultra 3", price:899, brand:"Apple", activity:["Kaikki"], gps:2, battery:3, music:2, smart:[0,1,2], img:"https://via.placeholder.com/300x200/1F2937/FFFFFF?text=Ultra+3" },
      { id:7, name:"Suunto Race", price:399, brand:"Suunto", activity:["Juoksu"], gps:2, battery:26, music:1, smart:[0], img:"https://via.placeholder.com/300x200/6366F1/FFFFFF?text=Suunto" },
      { id:8, name:"Garmin Forerunner 265", price:449, brand:"Garmin", activity:["Juoksu","Uinti","Pyöräily"], gps:2, battery:13, music:2, smart:[0,1], img:"https://via.placeholder.com/300x200/3B82F6/FFFFFF?text=265" }
    ];

    loadWatches();

    document.getElementById('quiz').addEventListener('submit', e => {
      e.preventDefault();
      if (watches.length === 0) return alert('Odota hetki – data latautuu...');

      const form = e.target;
      const answers = {
        activity: form.activity.value,
        budget: parseInt(form.budget.value),
        gps: parseInt(form.gps.value || 0),
        battery: parseInt(form.battery.value),
        music: parseInt(form.music.value),
        smart: Array.from(form.querySelectorAll('input[name="smart"]:checked'))
                 .map(c => parseInt(c.value))
                 .filter(v => v !== 3)
      };

      const scores = watches.map(watch => {
        let score = 0;
        if (watch.activity.some(a => answers.activity.includes(a) || a.includes(answers.activity))) score += 30;
        if (watch.price <= answers.budget) score += 20;
        if (watch.gps >= answers.gps) score += 15;
        if (watch.battery >= answers.battery) score += 15;
        if (watch.music >= answers.music) score += 10;
        answers.smart.forEach(s => { if (watch.smart?.includes(s)) score += 5; });
        return { watch, score };
      });

      const top3 = scores.sort((a,b) => b.score - a.score).slice(0,3);
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `
        <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Suositukset sinulle</h2>
        <div class="grid md:grid-cols-3 gap-6">
          ${top3.map((item, i) => `
            <div class="card bg-white rounded-2xl shadow-lg overflow-hidden">
              <img src="${item.watch.img}" alt="${item.watch.name}" class="w-full h-48 object-cover">
              <div class="p-5">
                <h3 class="text-xl font-bold text-gray-800">${item.watch.name}</h3>
                <p class="text-sm text-gray-600">${item.watch.brand}</p>
                <p class="text-2xl font-bold text-blue-600 mt-2">${item.watch.price} €</p>
                <div class="flex flex-wrap gap-1 mt-3">
                  ${item.watch.activity.slice(0,2).map(a => `<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${a}</span>`).join("")}
                </div>
                <a href="https://verkkokauppa.com/fi/search?query=${encodeURIComponent(item.watch.name)}" target="_blank" class="block w-full mt-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 rounded-xl text-center hover:shadow-lg transition">
                  Katso tarjous
                </a>
              </div>
            </div>
          `).join("")}
        </div>
        <div class="text-center mt-8">
          <button onclick="location.reload()" class="text-blue-600 underline">Aloita alusta</button>
          <p class="text-sm text-gray-500 mt-2">Vertailussa ${watches.length} mallia – päivittyy automaattisesti!</p>
        </div>
      `;
      resultsDiv.classList.remove('hidden');
      resultsDiv.scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
